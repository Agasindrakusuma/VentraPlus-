{% load static %}
<link href="{% static 'admin/assets/plugins/custom/datatables/datatables.bundle.css' %}" rel="stylesheet" type="text/css" />
<div class="card">
										<!--begin::Card header-->
										<div class="card-header border-0 pt-6">
											<!--begin::Card title-->
											 <div class="card-title">
												<div class="d-flex align-items-center position-relative my-1">
													<i class="ki-outline ki-magnifier fs-3 position-absolute ms-5"></i>
													<input type="text" 
														class="form-control form-control-solid w-250px ps-13" 
														placeholder="Search Berita..." 
														value="{{ search_query|default:'' }}" id="search-arsip"/>
												</div>
											</div>  
											<div class="card-toolbar">
												</div>
											
											</div>
										</div>
											
											<table class="table align-middle table-row-dashed fs-6 gy-5" id="table_arsip_partner">
												<thead>
													<tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0">

														<th class="text-center">No</th>
                                                        <th class="text-center">Judul</th>
                                                        <th class="text-center">Gambar</th>
                                                        <th class="text-center">Tag</th>
                                                        <th class="text-center">Deskripsi</th>
                                                        <th class="text-center">Kategori</th>
                                                        <th class="text-center">Tanggal Arsip</th>
                                                        <th class="text-end min-w-100px">Actions</th>
													</tr>
												</thead>
												<tbody class="text-gray-600 fw-semibold">
													{% for data_arsip in dt_arsip %}
													<tr>
														<td class="text-center">{{ forloop.counter }}</td>
                                                        <td class="text-center">{{ data_arsip.judul }}</td>
                                                        <td class="text-center" >
                                                            {% if data_arsip.images %}
                                                                <img src="{{ data_arsip.images.url }}" alt="images" width="100">
                                                            {% else %}
                                                                <img src="{% static 'admin/assets/media/svg/files/blank-image.svg' %}" width="100" alt="No Image">
                                                            {% endif %}
                                                        </td> 
                                                        <td class="text-center">
															{% if data_arsip.tag.all %}
															{% for tag in data_arsip.tag.all %}  <!-- Changed from data_berita.tags.all -->
						
															<span class="badge badge-light-primary">{{ tag.name }}</span>
															{% endfor %}
															{% else %}
															
															<span class="text-muted">Tidak ada tag</span>
															{% endif %}
						
														</td>
                                                        <td class="text-center">
                                                            <button onclick="showPdfPreview('{{ data_arsip.judul }}', `{{ data_arsip.deskripsi_berita|escapejs }}`)" 
                                                                    class="btn btn-sm btn-light-primary">
                                                                Preview
                                                            </button>
                                                        </td>
                                                        <td class="text-center">
                                                            {{ data_arsip.kategori_id.jenis_kategori|default:"-" }}
                                                        </td>
														<td class="text-center">{{ data_arsip.archived_at|date:"d/m/Y H:i" }}</td>
														<td class="text-end">
															<a href="#" class="btn btn-light btn-active-light-primary btn-flex btn-center btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
																Actions 
																<i class="ki-outline ki-down fs-5 ms-1"></i>
															</a>
															<!--begin::Menu-->
															<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true">
																
																<div class="menu-item px-3">
																	<a data-alt="{% url 'admin:edit_berita' data_arsip.berita_id %}" data-modal-title="Edit arsip" onclick="ModalEdit(this)" class="menu-link px-3">
																		Edit
																	</a>
																</div>
																<!--end::Menu item-->
																<!--begin::Menu item-->
																<div class="menu-item px-3">
																	<form method="post" action="{% url 'admin:restore_berita' data_arsip.berita_id %}" id="archive-form-{{ data_berita.berita_id }}">
																		{% csrf_token %}
																		<a href="#" class="menu-link px-3" onclick="confirmPulihkan('{{ data_berita.berita_id }}')">
																			pulihkan
																		</a>
																	</form>
																</div>

																<div class="menu-item px-3">
																	<form method="get" action="{% url 'admin:hapus_berita' data_arsip.berita_id %}" id="archive-form-{{ data_arsip.berita_id }}">
																		{% csrf_token %}
																		<a href="#" class="menu-link px-3" onclick="confirmHapus('{{ data_arsip.berita_id }}')">
																			hapus
																		</a>
																	</form>
																</div>
																<!--end::Menu item-->
															</div>
															<!--end::Menu-->
														</td>
														
													</tr>
													
													{% endfor %}
												</tbody>
											</table>
										</div>

{% block js %}
<script src="{% static 'admin/assets/plugins/custom/datatables/datatables.bundle.js' %}"></script>
<script>
    function initDataTableArsip() {
        // Destroy DataTable jika sudah ada
        if ($.fn.DataTable.isDataTable('#table_arsip_partner')) {
            $('#table_arsip_partner').DataTable().destroy();
        }

        // Inisialisasi ulang DataTable
        window.table_arsip = new DataTable('#table_arsip_partner');

        // Setup search event listener
        $('#search-arsip').off('keyup').on('keyup', function () {
            window.table_arsip.search(this.value).draw();
        });

        console.log('DataTable diinisialisasi ulang');
    }

    // Inisialisasi saat dokumen siap
    $(document).ready(function () {
        initDataTableArsip();
    });

    // Jika menggunakan AJAX/SPA/tab/modal dynamic, pastikan panggil ini lagi setelah konten dimuat
    // Contoh: jika Anda reload bagian konten #table-view via AJAX
    function reloadArsipPartner() {
        $.get("{% url 'admin:arsip_berita' %}", function (html) {
            $('#table-view').html(html);
            initDataTableArsip(); // Panggil ulang setelah konten selesai dimuat
        });
    }

    // Anda bisa panggil reloadArsipKategori() dari tombol, tab, atau event lain sesuai kebutuhan
</script>
{% endblock %}