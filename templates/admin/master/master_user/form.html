<form method="post" enctype="multipart/form-data" class="form" action="{% if edit %}{% url 'admin:edit_master_user' user.user_id %}{% else %}{% url 'admin:tambah_master_user' %}{% endif %}">
    {% csrf_token %}
    <div class="d-flex flex-column scroll-y px-5 px-lg-10" data-kt-scroll="true">
        <!-- Avatar -->
        <div class="fv-row mb-7">
            <label class="required fw-semibold fs-6 mb-2">Cover</label>
            <div class="card-body pt-0">
                <div class="image-input image-input-outline" data-kt-image-input="true"
                     {% if user.images %}style="background-image: url('{{ user.images.url }}')"{% endif %}>
                    <div class="image-input-wrapper w-150px h-150px"
                         {% if user.images %}style="background-image: url('{{ user.images.url }}');"{% endif %}></div>

                    <label class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                           data-kt-image-input-action="change"
                           data-bs-toggle="tooltip"
                           title="Change cover">
                        <i class="ki-outline ki-pencil fs-7"></i>
                        <input type="file" id="user_image" name="user_image" accept=".png, .jpg, .jpeg" />
                    </label>

                    <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                          data-kt-image-input-action="cancel"
                          data-bs-toggle="tooltip"
                          title="Cancel cover">
                        <i class="ki-outline ki-cross fs-2"></i>
                    </span>

                    <span class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
                          data-kt-image-input-action="remove"
                          data-bs-toggle="tooltip"
                          title="Remove cover">
                        <i class="ki-outline ki-cross fs-2"></i>
                    </span>
                </div>
                <div class="text-muted fs-7 mt-2">Format: .png, .jpg, .jpeg</div>
            </div>
        </div>


        <!-- Email -->
        <div class="fv-row mb-7">
            <label class="required fw-semibold fs-6 mb-2">Email</label>
            <input type="email" value="{{ user.email }}" name="user_email" class="form-control form-control-solid" placeholder="example@domain.com" required />
        </div>

        <!-- Full Name -->
        <div class="fv-row mb-7">
            <label class="required fw-semibold fs-6 mb-2">Nama Lengkap</label>
            <input type="text" value="{{ user.username }}" name="user_name" class="form-control form-control-solid" placeholder="Nama Lengkap" required />
        </div>

        

        <!-- Password -->
        <div class="fv-row mb-7">
            <label class="fw-semibold fs-6 mb-2">Password</label>
            <input type="password" name="user_password" class="form-control form-control-solid" placeholder="****" />
        </div>

        <div class="fv-row mb-7">
            <label class="required fw-semibold fs-6 mb-2">Role</label>
            <select class="form-select form-select-transparent"  name="frm_role" data-control="select2" data-placeholder="Select an option">
                <option></option>
                {% for role in dt_role %}
                <option {% if edit %}{% if user.role == role.0 %} selected {% endif %}{% endif %} value="{{ role.0 }}">{{ role.1 }}
                    
                </option>
                {% endfor %}
            </select>
            
        </div>

    <!-- Usia -->
        <div class="fv-row mb-7">
            <label class="required fw-semibold fs-6 mb-2">tanggal Lahir</label>
            <input type="date" value="{{ user.date_of_birth|date:'Y-m-d' }}" name="tanggal_lahir" class="form-control form-control-solid" placeholder="Contoh: 25" required />
        </div>

        <!-- Tanggal Registrasi -->
        
        

        <!-- Role -->
        <!-- <div class="mb-5">
            <label class="required fw-semibold fs-6 mb-5">Role</label>
            <div class="form-check form-check-custom form-check-solid mb-2">
                <input class="form-check-input me-3" name="user_role" type="radio" value="{{ value }}" id="role_{{ value }}" {% if forloop.first %}checked{% endif %} />
                <label class="form-check-label" for="role_{{ value }}">
                    <div class="fw-bold text-gray-800">{{ label }}</div>
                </label>
            </div>
        </div> -->

        <!-- Status -->
        <!-- <div class="fv-row mb-7">
            <label class="required fw-semibold fs-6 mb-2">Status</label>
            <input type="text" name="user_status" class="form-control form-control-solid" placeholder="Aktif / Tidak Aktif" required />
        </div>
    </div> -->

    <!-- Submit -->
    <div class="text-center pt-10">
        <button type="reset" class="btn btn-light me-3" data-bs-dismiss="modal">Batal</button>
        <button type="submit" class="btn btn-primary">Simpan</button>
    </div>
</form>

<script>
    
    // Image preview handling
    function handleImagePreview(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const wrapper = input.closest('.image-input').querySelector('.image-input-wrapper');
                wrapper.style.backgroundImage = `url('${e.target.result}')`;
                wrapper.classList.add('image-input-wrapper-loaded');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    document.getElementById('user_image').addEventListener('change', function() {
        handleImagePreview(this);
    });

    if (typeof KTImageInput !== 'undefined') {
        new KTImageInput(document.querySelector('.image-input'));
    }

    document.querySelector('[data-kt-image-input-action="cancel"]').addEventListener('click', function(e) {
        e.preventDefault();
        const input = document.getElementById('user_image');
        input.value = '';
        const wrapper = input.closest('.image-input').querySelector('.image-input-wrapper');
        wrapper.style.backgroundImage = '';
        wrapper.classList.remove('image-input-wrapper-loaded');
    });

    document.querySelector('[data-kt-image-input-action="remove"]').addEventListener('click', function(e) {
        e.preventDefault();
        const input = document.getElementById('user_image');
        input.value = '';
        const wrapper = input.closest('.image-input').querySelector('.image-input-wrapper');
        wrapper.style.backgroundImage = '';
        wrapper.classList.remove('image-input-wrapper-loaded');
    });
</script>